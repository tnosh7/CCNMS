<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="digging">
	<insert id="insertDigging">
		INSERT INTO DIGGING(
			WRITER,
			SUBJECT,
			CONTENT,
			DIGGING_TOPIC,
			FILE,
			ENROLL_DT
		)
		VALUES (
			#{writer},
			#{subject},
			#{content},
			#{diggingTopic},
			#{file},
			NOW()
		)	
	</insert>
	<select id="selectListDiggingList" parameterType="String"  resultType="DiggingDTO">
		SELECT 
				*
		FROM 
			DIGGING
		WHERE 
			DIGGING_TOPIC = #{diggingTopic}
	</select>

	<select id="selectListPopulerList" parameterType="String"  resultType="DiggingDTO">
		SELECT 
				*
		FROM 
			DIGGING
		WHERE 
			DIGGING_TOPIC = #{diggingTopic} 
			AND
			ENROLL_DT >= DATE_SUB(NOW(),INTERVAL 7 DAY)
		ORDER BY 
			READ_CNT DESC
		LIMIT 3
	</select>
	<select id="selectOneDiggingCnt" resultType="int">
		SELECT 
			COUNT(*)
		FROM 
			DIGGING
	
	</select>
	
	<select id="selectListUser" parameterType="String"  resultType="DiggingDTO">
		SELECT 
				*
		FROM 
			USER
		WHERE 
			USER_ID = (SELECT WRITER FROM DIGGING)
	</select>
	
	<select id="selectDiggingDetail" parameterType="long" resultType="DiggingDTO">
		SELECT 
			*
		FROM 
			DIGGING
		WHERE 
			DIGGING_ID = #{diggingId}
	</select>
	<update id="updateReadCnt">
		UPDATE DIGGING
		SET 
			READ_CNT = READ_CNT + 1
		WHERE 
			DIGGING_ID = #{diggingId}
	</update>
	
	<update id="updateThumbsUp" parameterType="long">
		UPDATE DIGGING
		SET 
			THUMBS_UP = THUMBS_UP + 1 
		WHERE 
			DIGGING_ID = #{diggingId}
	</update>
	
	<select id="selectOneAllReplyCnt" parameterType="long" resultType="int">
		SELECT 
			COUNT(*)
		FROM 
			REPLY
		WHERE
			DIGGING_ID = #{diggingId}	
	</select>
	
	<select id="selectListReplyList" parameterType="long" resultType="ReplyDTO">
		SELECT 
			*
		FROM 
			REPLY
		WHERE
			DIGGING_ID = #{diggingId}
	</select>

	<select id="selectListRecentList" parameterType="String" resultType="DiggingDTO">
		SELECT 
			*
		FROM 
			DIGGING
		WHERE
			DIGGING_TOPIC = #{diggingTopic}
		ORDER BY
		 	ENROLL_DT DESC
		LIMIT 3
	</select>
</mapper>